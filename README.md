# AbemaTV Episode Extractor

AbemaTVのアニメ・ドラマページから話数ごとのタイトルとあらすじを抽出するPythonスクリプトです。

## 機能

- AbemaTVのアニメ・ドラマページから各話の情報を自動抽出
- 話数タイトル（JSON-LDデータから取得）
- 各話URL
- あらすじ（個別エピソードページから取得）
- YAML形式で出力

## インストール

### 必要なソフトウェア

- Python 3.7 以上
- pip

### 依存パッケージのインストール

```bash
pip install -r requirements.txt
```

## 使用方法

### 基本使用法

```bash
python3 extract_yaml_output.py
```

デフォルトで `https://abema.tv/video/title/26-249`（瑠璃の宝石）の情報を抽出します。

### URLを指定して実行

スクリプト内の `url` 変数を変更してください：

```python
# extract_yaml_output.py の7行目付近
url = 'https://abema.tv/video/title/189-85'  # 好きな作品のURLに変更
```

### テスト用スクリプト

別のURLでテストする場合：

```bash
python3 extract_test.py
```

デフォルトで `https://abema.tv/video/title/189-85`（機械じかけのマリー）をテストします。

## スクリプト解説

### 主要スクリプト

- **`extract_yaml_output.py`**: メインプログラム（完全版）
  - シリーズ情報・全エピソード・あらすじを抽出
  - YAML形式で出力 `episodes_output.yaml`

- **`extract_test.py`**: テスト用プログラム
  - 任意のURLで動作確認
  - 出力 `test_output.yaml`

- **`simple_extract.py`**: 簡易版
  - タイトルのみ抽出（高速）
  - テキストファイルに出力 `episodes_list.txt`

### 出力例

```yaml
series_title: 瑠璃の宝石
series_title_en: Ruri no Houseki
source_url: https://abema.tv/video/title/26-249
scraping_date: '2025-12-24'
episodes:
- episode_number: 1
  title: はじめての鉱物採集
  url: https://abema.tv/video/episode/26-249_s1_p1
  synopsis: 瑠璃の宝石 - 第1話 はじめての鉱物採集 - ...
```

## 仕組み

1. HTTPリクエストでAbemaTVページを取得
2. HTML内のJSON-LDデータ（`application/ld+json`）を解析
3. `ImageObject` の `caption` から話数・タイトルを抽出
4. 各エピソードページにアクセスして `description` からあらすじを取得
5. YAML形式で構造化・ファイル出力

## 注意事項

- AbemaTVのHTML構造変更によりスクリプトが動作しなくなる可能性があります
- 大量のリクエストを送信するとIPブロックされる可能性があるため注意
- スクリプトは教育・研究目的で作成しています

## 実績

- ✅ 瑠璃の宝石（26-249）: 全13話
- ✅ 機械じかけのマリー（189-85）: 全11話

## 開発

### 改善予定機能

- [ ] URLをコマンドライン引数で渡せるように
- [ ] 複数エピソードの並列取得
- [ ] CSV/Excel形式での出力
- [ ] エラー処理の強化

## ライセンス

MIT License

## 作者

Generated by Claude Code